# 2023_2024-introduction_to_distributed_technologies-k4111c-ishutina_e
University: [ITMO University](https://itmo.ru/ru/)
Faculty: [FICT](https://fict.itmo.ru)
Course: [Introduction to distributed technologies](https://github.com/itmo-ict-faculty/introduction-to-distributed-technologies)
Year: 2023/2024
Group: K4111с
Author: Ishutina Yelizaveta
Lab: Lab2
Date of create: 11.10.2023
Date of finished: .10.2023


## Лабораторная работа №2 "Развертывание веб сервиса в Minikube, доступ к веб интерфейсу сервиса. Мониторинг сервиса."

### Цель работы


### Задачи

### Ход работы
Ниже представлен пошаговый ход работы 

### 1. Запуск minikube
Первым делом, запускается minikube, как в первой лабораторной работе. 
![](/lab2/image/start.png)


### 2. Создание манифеста
Создется манифест `deployment` (прикреплен в директории). В нем описана конфигурация развертывания веб-сервиса. файл содержит в себе создание 3-х объектов k8s: deployment, service и ingress. Deployment содержит информацию об использованном образе, количестве реплик, порте и заданных переменных веб-сервиса, на основе чего создает 2 реплики pod'а с веб-сервисом. Объект service управляет доступом в данные pod'ы и позволяет передавать в них запросы и получать данные. Ingress описывает конфигурацию, с которой внешние запросы к кластеру будут приниматься и отправляться запросы на service, в частности это то, с каким доменным именем, путем, портом и протоколом будут обработаны запросы.

с 2 репликами контейнера [ifilyaninitmo/itdt-contained-frontend:master](https://hub.docker.com/repository/docker/ifilyaninitmo/itdt-contained-frontend) и передаются переменные в эти реплики: `REACT_APP_USERNAME`, `REACT_APP_COMPANY_NAME`.
Создать сервис через который у вас будет доступ на эти "поды". Выбор типа сервиса остается на ваше усмотрение.

Кратко пробежимся по назначению полям в `spec`:
* `replicas` отвечает за количество реплик контейнеров, которые необходимо создать
* `selector` указывает `ReplicaSet` (которая создается деплойментом), какими подами она сможет управлять. По большому счету, это {k, v}-мапа, и для выбора конкретного пода нужно совпадение всех ключей с метками.
* `template` описывает шаблон подов, которые необходимо создать. Внутри него все идентичном заданию из первой лабы, но здесь мы добавили еще одно поле, о нём ниже.
* `env` позволяет выставить переменные окружения внутри контейнеров.

Также в манифесте описывается создание сервиса, что требуется по задаче. 


### 3. Запуск
С помощью следующей команды на API k8s кластера отправляется информация о том, что необходимо создать:
```
kubectl apply -f deployment.yaml
```

![](/lab2/image/2.png)


Удостоверяемся, что все создалось с помощью следующих команд:
```
kubectl get deployments
kubectl get rs
kubectl get pods
```

![](/lab2/image/4.png)

![](/lab2/image/5.png)

![](/lab2/image/6.png)

Как видим, все успешно запустилось.

### 4. Подключение к контейнерам

Для этого, мы сначала запускаем в minikube режим проброса портов с помощью следующей команды:

```
kubectl port-forward service/app 3000:3000
```
![](/lab2/image/7.png)

Подключаемся к контейнерам через браузер, отлично все работает

![](/lab2/image/8.png)

Значения переменных соответствуют тем, которые были переданы в коде. Также указано название пода и айпи - оно может меняться в завимости от того, в какой под идёт запрос. У нас две реплики, в браузере отображается информация одной из них.



### 5. Проверка логов 

Смотрим логи с помощью команды:

```
kubectl logs app-d666448d6-m9l2k
```

![](/lab2/image/10.png)

Логи одинаковые

### 6. Схема организации контейеров и сервисов нарисованная в draw.io


